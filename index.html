<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡å±•ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .breadcrumb {
            color: #666;
            margin-bottom: 25px;
            font-size: 14px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            margin: 0 5px;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .folder-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .folder-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 500;
            opacity: 0;
            animation: fadeInUp 0.5s ease-out forwards;
        }

        .folder-item:nth-child(1) { animation-delay: 0.1s; }
        .folder-item:nth-child(2) { animation-delay: 0.2s; }
        .folder-item:nth-child(3) { animation-delay: 0.3s; }
        .folder-item:nth-child(4) { animation-delay: 0.4s; }
        .folder-item:nth-child(5) { animation-delay: 0.5s; }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .folder-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .folder-item::before {
            content: "ğŸ“";
            display: block;
            font-size: 40px;
            margin-bottom: 10px;
        }

        .image-container {
            text-align: center;
            margin-top: 30px;
        }

        .random-image {
            width: 512px;
            height: 512px;
            object-fit: contain;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin: 20px auto;
            display: block;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .random-image.loaded {
            opacity: 1;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .share-link {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            word-break: break-all;
            font-size: 14px;
            color: #666;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state::before {
            content: "ğŸ“·";
            display: block;
            font-size: 60px;
            margin-bottom: 20px;
        }

        .image-count {
            color: #666;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .random-image {
                width: 100%;
                height: auto;
                max-width: 512px;
            }
            
            .folder-list {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>å›¾ç‰‡éšæœºå±•ç¤º</h1>
        <div class="breadcrumb" id="breadcrumb">é¦–é¡µ</div>
        
        <div class="folder-list" id="folderList"></div>
        
        <div class="image-container" id="imageContainer"></div>
    </div>

    <script>
        // é…ç½®æ–‡ä»¶ï¼šå®šä¹‰ä½ çš„æ–‡ä»¶å¤¹ç»“æ„å’Œå›¾ç‰‡
        // âš ï¸ é‡è¦ï¼šè¯·ç”¨ Python è„šæœ¬ç”Ÿæˆçš„é…ç½®æ›¿æ¢è¿™é‡Œçš„å†…å®¹
        // è„šæœ¬ä¼šç”Ÿæˆ image_config.js æ–‡ä»¶ï¼Œå¤åˆ¶é‡Œé¢çš„ imageStructure å¯¹è±¡åˆ°è¿™é‡Œ
        
        const imageStructure = {
            "FOV": {
                images: [
                    "https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/main/FOV/01.jpg",
                    "https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/main/FOV/02.jpg",
                    "https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/main/FOV/03.jpg",
                    "https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/main/FOV/04.jpg",
                    "https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/main/FOV/05.jpg"
                ]
            },
            "Pretrain+FOV": {
                images: [
                    "https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/main/Pretrain+FOV/01.jpg",
                    "https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/main/Pretrain+FOV/02.jpg",
                    "https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/main/Pretrain+FOV/03.jpg",
                    "https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/main/Pretrain+FOV/04.jpg",
                    "https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/main/Pretrain+FOV/05.jpg"
                ]
            },
            "baseline": {
                images: [
                    "https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/main/baseline/01.jpg",
                    "https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/main/baseline/02.jpg",
                    "https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/main/baseline/03.jpg",
                    "https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/main/baseline/04.jpg",
                    "https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/main/baseline/05.jpg"
                ]
            },
            "eyediff": {
                images: [
                    "https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/main/eyediff/01.jpg",
                    "https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/main/eyediff/02.jpg",
                    "https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/main/eyediff/03.jpg",
                    "https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/main/eyediff/04.jpg",
                    "https://raw.githubusercontent.com/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å/main/eyediff/05.jpg"
                ]
            }
        };
        
        // âš ï¸ è®°å¾—æŠŠä¸Šé¢çš„ "ä½ çš„ç”¨æˆ·å" å’Œ "ä½ çš„ä»“åº“å" æ›¿æ¢æˆå®é™…çš„å€¼ï¼

        let currentPath = [];
        let currentImages = [];

        function getCurrentFolder() {
            let folder = imageStructure;
            console.log('å¼€å§‹è·å–æ–‡ä»¶å¤¹ï¼Œå½“å‰è·¯å¾„:', currentPath);
            console.log('åˆå§‹ imageStructure é¡¶å±‚:', Object.keys(imageStructure));
            
            for (let i = 0; i < currentPath.length; i++) {
                const pathPart = currentPath[i];
                console.log(`ç¬¬ ${i+1} å±‚è·¯å¾„: "${pathPart}"`);
                console.log('å½“å‰ folder çš„é”®:', Object.keys(folder));
                
                // å…ˆå°è¯•ç›´æ¥è®¿é—®ï¼ˆé¡¶å±‚ç»“æ„ï¼‰
                if (folder[pathPart]) {
                    folder = folder[pathPart];
                    console.log(`âœ“ ç›´æ¥æ‰¾åˆ°: ${pathPart}`);
                }
                // å†å°è¯•è®¿é—® folders å±æ€§ï¼ˆåµŒå¥—ç»“æ„ï¼‰
                else if (folder.folders && folder.folders[pathPart]) {
                    folder = folder.folders[pathPart];
                    console.log(`âœ“ åœ¨ folders ä¸­æ‰¾åˆ°: ${pathPart}`);
                }
                // éƒ½æ‰¾ä¸åˆ°ï¼Œè¿”å›æ ¹ç›®å½•
                else {
                    console.error(`âœ— è·¯å¾„ä¸å­˜åœ¨: "${pathPart}"`);
                    console.log('å½“å‰ folder å®Œæ•´å†…å®¹:', folder);
                    console.log('è¿”å›åˆ°æ ¹ç›®å½•');
                    return imageStructure;
                }
                
                console.log('ç§»åŠ¨åçš„ç»“æ„:', {
                    hasFolders: !!folder.folders,
                    hasImages: !!folder.images,
                    keys: Object.keys(folder)
                });
            }
            
            console.log('âœ“ æœ€ç»ˆåˆ°è¾¾çš„æ–‡ä»¶å¤¹:', {
                hasFolders: !!folder.folders,
                hasImages: !!folder.images,
                folderKeys: folder.folders ? Object.keys(folder.folders) : [],
                imageCount: folder.images ? folder.images.length : 0
            });
            return folder;
        }

        function updateBreadcrumb() {
            const breadcrumb = document.getElementById('breadcrumb');
            let html = '<a href="#" onclick="navigateTo([]); return false;">é¦–é¡µ</a>';
            
            for (let i = 0; i < currentPath.length; i++) {
                const path = currentPath.slice(0, i + 1);
                html += ' / <a href="#" onclick="navigateTo(' + JSON.stringify(path) + '); return false;">' + currentPath[i] + '</a>';
            }
            
            breadcrumb.innerHTML = html;
        }

        function displayFolders() {
            const folderList = document.getElementById('folderList');
            const currentFolder = getCurrentFolder();
            
            folderList.innerHTML = '';
            
            // è°ƒè¯•ä¿¡æ¯
            console.log('å½“å‰è·¯å¾„:', currentPath);
            console.log('å½“å‰æ–‡ä»¶å¤¹:', currentFolder);
            
            if (currentFolder.folders) {
                console.log('æ‰¾åˆ°å­æ–‡ä»¶å¤¹:', Object.keys(currentFolder.folders));
                for (let folderName in currentFolder.folders) {
                    const div = document.createElement('div');
                    div.className = 'folder-item';
                    div.textContent = folderName;
                    div.onclick = () => {
                        console.log('ç‚¹å‡»æ–‡ä»¶å¤¹:', folderName);
                        navigateTo([...currentPath, folderName]);
                    };
                    folderList.appendChild(div);
                }
            } else {
                console.log('æ²¡æœ‰å­æ–‡ä»¶å¤¹');
            }
        }

        function displayRandomImage() {
            const imageContainer = document.getElementById('imageContainer');
            const currentFolder = getCurrentFolder();
            
            currentImages = currentFolder.images || [];
            
            if (currentImages.length === 0) {
                if (!currentFolder.folders || Object.keys(currentFolder.folders).length === 0) {
                    imageContainer.innerHTML = '<div class="empty-state">æ­¤æ–‡ä»¶å¤¹æš‚æ— å›¾ç‰‡</div>';
                } else {
                    imageContainer.innerHTML = '';
                }
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            imageContainer.innerHTML = '<div class="loading-spinner"></div>';
            
            // å»¶è¿Ÿ 300ms ååŠ è½½å›¾ç‰‡
            setTimeout(() => {
                const randomIndex = Math.floor(Math.random() * currentImages.length);
                const imageUrl = currentImages[randomIndex];
                
                const img = new Image();
                
                // å›¾ç‰‡åŠ è½½å®Œæˆåå†æ˜¾ç¤º
                img.onload = function() {
                    imageContainer.innerHTML = `
                        <img src="${imageUrl}" alt="éšæœºå›¾ç‰‡" class="random-image" id="randomImg">
                    `;
                    
                    // æ·»åŠ æ·¡å…¥æ•ˆæœ
                    const imgElement = document.getElementById('randomImg');
                    setTimeout(() => {
                        imgElement.classList.add('loaded');
                    }, 50);
                };
                
                // å›¾ç‰‡åŠ è½½å¤±è´¥
                img.onerror = function() {
                    imageContainer.innerHTML = `
                        <div class="empty-state">
                            å›¾ç‰‡åŠ è½½å¤±è´¥<br>
                            <small style="color:#999; font-size:12px; margin-top:10px; display:block;">
                                ${imageUrl}
                            </small>
                        </div>
                    `;
                };
                
                // å¼€å§‹åŠ è½½å›¾ç‰‡
                img.src = imageUrl;
            }, 300);
        }

        function navigateTo(path) {
            console.log('=== å¯¼èˆªåˆ°:', path);
            currentPath = path;
            updateBreadcrumb();
            displayFolders();
            displayRandomImage();
            updateURL();
            console.log('=== å¯¼èˆªå®Œæˆ ===');
        }

        function updateURL() {
            const pathString = currentPath.join('/');
            const newUrl = window.location.pathname + (pathString ? '?path=' + encodeURIComponent(pathString) : '');
            window.history.pushState({path: currentPath}, '', newUrl);
        }

        function updateShareLink() {
            const shareLink = document.getElementById('shareLink');
            if (shareLink) {
                const fullUrl = window.location.origin + window.location.pathname + '?path=' + encodeURIComponent(currentPath.join('/'));
                shareLink.textContent = 'åˆ†äº«é“¾æ¥: ' + fullUrl;
            }
        }

        function copyShareLink() {
            const fullUrl = window.location.origin + window.location.pathname + '?path=' + encodeURIComponent(currentPath.join('/'));
            navigator.clipboard.writeText(fullUrl).then(() => {
                alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }

        function downloadImage() {
            const img = document.getElementById('randomImg');
            if (img) {
                const link = document.createElement('a');
                link.href = img.src;
                link.download = 'image_' + Date.now() + '.jpg';
                link.click();
            }
        }

        // åˆå§‹åŒ–ï¼šä» URL å‚æ•°è¯»å–è·¯å¾„
        window.addEventListener('load', () => {
            // æ£€æŸ¥é…ç½®
            console.log('=== é…ç½®æ£€æŸ¥ ===');
            console.log('é¡¶å±‚æ–‡ä»¶å¤¹:', Object.keys(imageStructure));
            
            // æ£€æŸ¥æ¯ä¸ªé¡¶å±‚æ–‡ä»¶å¤¹çš„ç»“æ„
            for (let key in imageStructure) {
                const folder = imageStructure[key];
                console.log(`${key}:`, {
                    hasFolders: !!folder.folders,
                    hasImages: !!folder.images,
                    foldersCount: folder.folders ? Object.keys(folder.folders).length : 0,
                    imagesCount: folder.images ? folder.images.length : 0
                });
            }
            console.log('=== é…ç½®æ£€æŸ¥å®Œæˆ ===');
            
            const urlParams = new URLSearchParams(window.location.search);
            const pathString = urlParams.get('path');
            
            if (pathString) {
                currentPath = pathString.split('/').filter(p => p);
            }
            
            navigateTo(currentPath);
        });

        // å¤„ç†æµè§ˆå™¨å‰è¿›åé€€
        window.addEventListener('popstate', (event) => {
            if (event.state && event.state.path) {
                navigateTo(event.state.path);
            }
        });
    </script>
</body>
</html>
